<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Jogo da Cobrinha</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        background-color: #222;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        color: #fff;
      }

      #gameContainer {
        position: relative;
        margin-top: 3rem;
      }

      #gameCanvas {
        background-color: #333;
        border: 10px solid #444;
        box-shadow: 0 0 20px #000;
        display: block;
      }

      #message {
        font-size: 24px;
        color: #fff;
        text-align: center;
        margin-top: -50px;
      }

      #scoreDisplay {
        position: absolute;
        top: -50px;
        left: 0;
        font-size: 24px;
      }

      #scoreboard {
        margin-left: 20px;
        width: 200px;
        margin-top: 3rem;
      }

      #scoreboard h2 {
        text-align: center;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
      }

      #scoreList {
        list-style: none;
        padding: 0;
        margin-top: 20px;
      }

      #scoreList li {
        display: flex;
        align-items: center;
        padding: 5px 0;
        border-bottom: 1px solid #555;
      }

      .trophy {
        font-size: 20px;
        margin-right: 10px;
        width: 30px;
        text-align: center;
      }

      .gold {
        color: gold;
      }

      .silver {
        color: silver;
      }

      .bronze {
        color: #cd7f32;
      }

      .scoreEntry {
        display: flex;
        justify-content: space-between;
        width: 100%;
      }

      .playerName {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="message">Pressione Espa√ßo para iniciar o jogo</div>
      <div id="scoreDisplay">Pontua√ß√£o: <span id="currentScore">0</span></div>
    </div>
    <div id="scoreboard">
      <h2>Ranking</h2>
      <ul id="scoreList"></ul>
    </div>
    <script>
      window.onload = function () {
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        var gridSize = 20;
        var tileCountX = canvas.width / gridSize;
        var tileCountY = canvas.height / gridSize;

        var snake = [];
        var snakeLength = 5;
        var snakeDirection = "";
        var gameInterval;
        var gameRunning = false;

        var food = { x: 0, y: 0 };
        var currentFruit;
        var fruits = [
          { name: "Ma√ß√£", emoji: "üçé", color: "#ff4d4d", points: 1 },
          { name: "Banana", emoji: "üçå", color: "#ffff66", points: 1 },
          { name: "Uva", emoji: "üçá", color: "#8a2be2", points: 1 },
          { name: "Laranja", emoji: "üçä", color: "#ffa500", points: 1 },
          { name: "Melancia", emoji: "üçâ", color: "#fc6c85", points: 1 },
          { name: "Morango", emoji: "üçì", color: "#ff0000", points: 1 },
          { name: "Cereja", emoji: "üçí", color: "#de3163", points: 1 },
          { name: "Abacaxi", emoji: "üçç", color: "#fce903", points: 1 },
          { name: "P√™ssego", emoji: "üçë", color: "#ffb347", points: 1 },
          { name: "Kiwi", emoji: "ü•ù", color: "#76b852", points: 1 },
        ];

        var score = 0;

        document.addEventListener("keydown", keyDownHandler);

        loadScores();
        displayScores();

        function keyDownHandler(e) {
          var key = e.key.toLowerCase();
          if (!gameRunning && key === " ") {
            startGame();
          } else if (gameRunning) {
            if (["w", "a", "s", "d"].includes(key)) {
              changeDirection(key);
            }
          }
        }

        function startGame() {
          snake = [];
          snakeLength = 1;
          snakeDirection = getRandomDirection();
          gameRunning = true;
          score = 0;
          updateScoreDisplay();
          placeFood();
          document.getElementById("message").style.display = "none";
          var startX = Math.floor(tileCountX / 2);
          var startY = Math.floor(tileCountY / 2);
          for (var i = 0; i < snakeLength; i++) {
            snake.push({ x: startX, y: startY, color: "#8bc34a" });
          }
          clearInterval(gameInterval);
          gameInterval = setInterval(gameLoop, 100);
        }

        function getRandomDirection() {
          var directions = ["w", "a", "s", "d"];
          return directions[Math.floor(Math.random() * directions.length)];
        }

        function changeDirection(key) {
          if (key === "w" && snakeDirection !== "s") snakeDirection = "w";
          if (key === "s" && snakeDirection !== "w") snakeDirection = "s";
          if (key === "a" && snakeDirection !== "d") snakeDirection = "a";
          if (key === "d" && snakeDirection !== "a") snakeDirection = "d";
        }

        function placeFood() {
          food.x = Math.floor(Math.random() * tileCountX);
          food.y = Math.floor(Math.random() * tileCountY);
          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === food.x && snake[i].y === food.y) {
              placeFood();
              return;
            }
          }
          currentFruit = fruits[Math.floor(Math.random() * fruits.length)];
        }

        function gameLoop() {
          var headX = snake[0].x;
          var headY = snake[0].y;

          if (snakeDirection === "w") headY--;
          if (snakeDirection === "s") headY++;
          if (snakeDirection === "a") headX--;
          if (snakeDirection === "d") headX++;

          if (
            headX < 0 ||
            headX >= tileCountX ||
            headY < 0 ||
            headY >= tileCountY
          ) {
            gameOver();
            return;
          }

          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === headX && snake[i].y === headY) {
              gameOver();
              return;
            }
          }

          var ateFood = false;
          var eatenFruitColor = snake[0].color; // Cor padr√£o
          if (headX === food.x && headY === food.y) {
            ateFood = true;
            snakeLength++;
            score += currentFruit.points;
            updateScoreDisplay();
            eatenFruitColor = currentFruit.color; // Cor da fruta comida
            placeFood();
          }

          var newHeadColor = ateFood ? eatenFruitColor : snake[0].color;
          snake.unshift({ x: headX, y: headY, color: newHeadColor });

          while (snake.length > snakeLength) {
            snake.pop();
          }

          drawGame();
        }

        function drawGame() {
          ctx.fillStyle = "#333";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          for (var i = 0; i < snake.length; i++) {
            ctx.fillStyle = snake[i].color;
            ctx.fillRect(
              snake[i].x * gridSize,
              snake[i].y * gridSize,
              gridSize - 1,
              gridSize - 1
            );
          }

          ctx.font = gridSize + "px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            currentFruit.emoji,
            food.x * gridSize + gridSize / 2,
            food.y * gridSize + gridSize / 2
          );
        }

        function gameOver() {
          gameRunning = false;
          clearInterval(gameInterval);
          var playerName = prompt(
            "Game Over! Sua pontua√ß√£o: " +
              score +
              ". Digite seu nome para salvar no ranking:"
          );
          if (playerName) {
            saveScore(playerName, score);
            displayScores();
          }
          document.getElementById("message").innerText =
            "Pressione Espa√ßo para reiniciar";
          document.getElementById("message").style.display = "block";
        }

        function saveScore(name, score) {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          scores.push({ name: name, score: score });
          scores.sort(function (a, b) {
            return b.score - a.score;
          });
          if (scores.length > 10) {
            scores = scores.slice(0, 10);
          }
          localStorage.setItem("snakeScores", JSON.stringify(scores));
        }

        function loadScores() {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          return scores;
        }

        function displayScores() {
          var scores = loadScores();
          var scoreList = document.getElementById("scoreList");
          scoreList.innerHTML = "";
          for (var i = 0; i < scores.length; i++) {
            var li = document.createElement("li");

            var trophySpan = document.createElement("span");
            trophySpan.classList.add("trophy");
            if (i === 0) {
              trophySpan.classList.add("gold");
              trophySpan.innerHTML = "üèÜ";
            } else if (i === 1) {
              trophySpan.classList.add("silver");
              trophySpan.innerHTML = "ü•à";
            } else if (i === 2) {
              trophySpan.classList.add("bronze");
              trophySpan.innerHTML = "ü•â";
            } else {
              trophySpan.innerHTML = i + 1 + ".";
            }

            var scoreEntry = document.createElement("div");
            scoreEntry.classList.add("scoreEntry");

            var nameSpan = document.createElement("span");
            nameSpan.classList.add("playerName");
            nameSpan.textContent = scores[i].name;

            var scoreSpan = document.createElement("span");
            scoreSpan.textContent = scores[i].score;

            scoreEntry.appendChild(nameSpan);
            scoreEntry.appendChild(scoreSpan);

            li.appendChild(trophySpan);
            li.appendChild(scoreEntry);

            scoreList.appendChild(li);
          }
        }

        function updateScoreDisplay() {
          document.getElementById("currentScore").innerText = score;
        }
      };
    </script>
  </body>
</html>
