<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Jogo da Cobrinha</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        background-color: #222;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        color: #fff;
      }

      #gameContainer {
        position: relative;
        margin-top: 3rem;
      }

      #gameCanvas {
        background-color: #333;
        border: 10px solid #444;
        box-shadow: 0 0 20px #000;
        display: block;
      }

      #message {
        font-size: 24px;
        color: #fff;
        text-align: center;
        margin-top: -50px;
      }

      #scoreDisplay {
        position: absolute;
        top: -50px;
        left: 0;
        font-size: 24px;
      }

      #timeDisplay {
        margin-top: 20px;
        font-size: 24px;
        text-align: center;
      }

      #scoreboard {
        margin-left: 20px;
        width: 500px;
        margin-top: 3rem;
      }

      #scoreboard h2 {
        text-align: center;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
      }

      #scoreTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      #scoreTable th,
      #scoreTable td {
        border: 1px solid #555;
        padding: 8px;
        text-align: center;
      }

      #scoreTable th {
        background-color: #444;
      }

      .trophy {
        font-size: 20px;
        width: 30px;
        text-align: center;
      }

      .gold {
        color: gold;
      }

      .silver {
        color: silver;
      }

      .bronze {
        color: #cd7f32;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="message">Pressione Espa√ßo para iniciar o jogo</div>
      <div id="scoreDisplay">Pontua√ß√£o: <span id="currentScore">0</span></div>
      <div id="timeDisplay">
        Tempo: <span id="currentTime">00:00:00:00</span>
      </div>
    </div>
    <div id="scoreboard">
      <h2>Ranking</h2>
      <table id="scoreTable">
        <thead>
          <tr>
            <th>Posi√ß√£o</th>
            <th>Nome</th>
            <th>Tempo</th>
            <th>Frutas</th>
            <th>Pontua√ß√£o</th>
          </tr>
        </thead>
        <tbody id="scoreTableBody"></tbody>
      </table>
    </div>
    <script>
      window.onload = function () {
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        var gridSize = 20;
        var tileCountX = canvas.width / gridSize;
        var tileCountY = canvas.height / gridSize;

        var snake = [];
        var snakeLength = 5;
        var snakeDirection = "";
        var gameInterval;
        var gameRunning = false;

        var food = { x: 0, y: 0 };
        var currentFruit;
        var fruits = [
          { name: "Ma√ß√£", emoji: "üçé", color: "#ff4d4d", points: 1 },
          { name: "Banana", emoji: "üçå", color: "#ffff66", points: 1 },
          { name: "Uva", emoji: "üçá", color: "#8a2be2", points: 1 },
          { name: "Laranja", emoji: "üçä", color: "#ffa500", points: 1 },
          { name: "Melancia", emoji: "üçâ", color: "#fc6c85", points: 1 },
          { name: "Morango", emoji: "üçì", color: "#ff0000", points: 1 },
          { name: "Cereja", emoji: "üçí", color: "#de3163", points: 1 },
          { name: "Abacaxi", emoji: "üçç", color: "#fce903", points: 1 },
          { name: "P√™ssego", emoji: "üçë", color: "#ffb347", points: 1 },
          { name: "Kiwi", emoji: "ü•ù", color: "#76b852", points: 1 },
        ];

        var score = 0;
        var fruitsEaten = 0;
        var startTime;
        var elapsedTime = 0;
        var timeInterval;

        document.addEventListener("keydown", keyDownHandler);

        loadScores();
        displayScores();

        function keyDownHandler(e) {
          var key = e.key.toLowerCase();
          if (!gameRunning && key === " ") {
            startGame();
          } else if (gameRunning) {
            if (["w", "a", "s", "d"].includes(key)) {
              changeDirection(key);
            }
          }
        }

        function startGame() {
          snake = [];
          snakeLength = 1;
          snakeDirection = getRandomDirection();
          gameRunning = true;
          score = 0;
          fruitsEaten = 0;
          elapsedTime = 0;
          updateScoreDisplay();
          updateTimeDisplay();
          placeFood();
          document.getElementById("message").style.display = "none";
          var startX = Math.floor(tileCountX / 2);
          var startY = Math.floor(tileCountY / 2);
          for (var i = 0; i < snakeLength; i++) {
            snake.push({ x: startX, y: startY, color: "#8bc34a" });
          }
          clearInterval(gameInterval);
          clearInterval(timeInterval);
          gameInterval = setInterval(gameLoop, 100);
          startTime = Date.now();
          timeInterval = setInterval(updateElapsedTime, 10); // Atualiza a cada 10ms
        }

        function getRandomDirection() {
          var directions = ["w", "a", "s", "d"];
          return directions[Math.floor(Math.random() * directions.length)];
        }

        function changeDirection(key) {
          if (key === "w" && snakeDirection !== "s") snakeDirection = "w";
          if (key === "s" && snakeDirection !== "w") snakeDirection = "s";
          if (key === "a" && snakeDirection !== "d") snakeDirection = "a";
          if (key === "d" && snakeDirection !== "a") snakeDirection = "d";
        }

        function placeFood() {
          food.x = Math.floor(Math.random() * tileCountX);
          food.y = Math.floor(Math.random() * tileCountY);
          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === food.x && snake[i].y === food.y) {
              placeFood();
              return;
            }
          }
          currentFruit = fruits[Math.floor(Math.random() * fruits.length)];
        }

        function gameLoop() {
          var headX = snake[0].x;
          var headY = snake[0].y;

          if (snakeDirection === "w") headY--;
          if (snakeDirection === "s") headY++;
          if (snakeDirection === "a") headX--;
          if (snakeDirection === "d") headX++;

          if (
            headX < 0 ||
            headX >= tileCountX ||
            headY < 0 ||
            headY >= tileCountY
          ) {
            gameOver();
            return;
          }

          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === headX && snake[i].y === headY) {
              gameOver();
              return;
            }
          }

          var ateFood = false;
          var eatenFruitColor = snake[0].color; // Cor padr√£o
          if (headX === food.x && headY === food.y) {
            ateFood = true;
            snakeLength++;
            score += currentFruit.points;
            fruitsEaten++;
            updateScoreDisplay();
            eatenFruitColor = currentFruit.color; // Cor da fruta comida
            placeFood();
          }

          var newHeadColor = ateFood ? eatenFruitColor : snake[0].color;
          snake.unshift({ x: headX, y: headY, color: newHeadColor });

          while (snake.length > snakeLength) {
            snake.pop();
          }

          drawGame();
        }

        function drawGame() {
          ctx.fillStyle = "#333";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          for (var i = 0; i < snake.length; i++) {
            ctx.fillStyle = snake[i].color;
            ctx.fillRect(
              snake[i].x * gridSize,
              snake[i].y * gridSize,
              gridSize - 1,
              gridSize - 1
            );
          }

          ctx.font = gridSize + "px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            currentFruit.emoji,
            food.x * gridSize + gridSize / 2,
            food.y * gridSize + gridSize / 2
          );
        }

        function gameOver() {
          gameRunning = false;
          clearInterval(gameInterval);
          clearInterval(timeInterval);
          var playerName = prompt(
            "Game Over! Sua pontua√ß√£o: " +
              score +
              ". Digite seu nome para salvar no ranking:"
          );
          if (playerName) {
            saveScore(playerName, score, elapsedTime, fruitsEaten);
            displayScores();
          }
          document.getElementById("message").innerText =
            "Pressione Espa√ßo para reiniciar";
          document.getElementById("message").style.display = "block";
        }

        function saveScore(name, score, time, fruitsEaten) {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          scores.push({
            name: name,
            score: score,
            time: time,
            fruits: fruitsEaten,
          });
          scores.sort(function (a, b) {
            return b.score - a.score;
          });
          if (scores.length > 10) {
            scores = scores.slice(0, 10);
          }
          localStorage.setItem("snakeScores", JSON.stringify(scores));
        }

        function loadScores() {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          return scores;
        }

        function displayScores() {
          var scores = loadScores();
          var scoreTableBody = document.getElementById("scoreTableBody");
          scoreTableBody.innerHTML = "";
          for (var i = 0; i < scores.length; i++) {
            var tr = document.createElement("tr");

            var positionTd = document.createElement("td");
            var nameTd = document.createElement("td");
            var timeTd = document.createElement("td");
            var fruitsTd = document.createElement("td");
            var scoreTd = document.createElement("td");

            // Posi√ß√£o e Trof√©u
            if (i === 0) {
              positionTd.innerHTML = '<span class="trophy gold">üèÜ</span>';
            } else if (i === 1) {
              positionTd.innerHTML = '<span class="trophy silver">ü•à</span>';
            } else if (i === 2) {
              positionTd.innerHTML = '<span class="trophy bronze">ü•â</span>';
            } else {
              positionTd.textContent = i + 1 + ".";
            }

            // Nome
            nameTd.textContent = scores[i].name;

            // Tempo com cent√©simos
            timeTd.textContent = formatTime(scores[i].time);

            // Frutas
            fruitsTd.textContent = scores[i].fruits;

            // Pontua√ß√£o
            scoreTd.textContent = scores[i].score;

            tr.appendChild(positionTd);
            tr.appendChild(nameTd);
            tr.appendChild(timeTd);
            tr.appendChild(fruitsTd);
            tr.appendChild(scoreTd);

            scoreTableBody.appendChild(tr);
          }
        }

        function updateScoreDisplay() {
          document.getElementById("currentScore").innerText = score;
        }

        function updateElapsedTime() {
          elapsedTime = Date.now() - startTime;
          updateTimeDisplay();
        }

        function updateTimeDisplay() {
          document.getElementById("currentTime").innerText =
            formatTime(elapsedTime);
        }

        function formatTime(milliseconds) {
          var hrs = Math.floor(milliseconds / 3600000);
          var mins = Math.floor((milliseconds % 3600000) / 60000);
          var secs = Math.floor((milliseconds % 60000) / 1000);
          var centis = Math.floor((milliseconds % 1000) / 10);

          return (
            (hrs < 10 ? "0" + hrs : hrs) +
            ":" +
            (mins < 10 ? "0" + mins : mins) +
            ":" +
            (secs < 10 ? "0" + secs : secs) +
            ":" +
            (centis < 10 ? "0" + centis : centis)
          );
        }
      };
    </script>
  </body>
</html>
