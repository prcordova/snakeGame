<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <title>Jogo da Cobrinha</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        background-color: #222;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        color: #fff;
      }

      #gameContainer {
        position: relative;
        margin-top: 3rem;
      }

      #gameCanvas {
        background-color: #333;
        border: 10px solid #444;
        box-shadow: 0 0 20px #000;
        display: block;
      }

      #message {
        font-size: 24px;
        color: #fff;
        text-align: center;
        margin-top: -50px;
      }

      #scoreDisplay {
        position: absolute;
        top: -50px;
        left: 0;
        font-size: 24px;
      }

      #timeDisplay {
        margin-top: 20px;
        font-size: 24px;
        text-align: center;
      }

      #scoreboard {
        margin-left: 20px;
        width: 500px;
        margin-top: 3rem;
      }

      #scoreboard h2 {
        text-align: center;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
      }

      #scoreTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      #scoreTable th,
      #scoreTable td {
        border: 1px solid #555;
        padding: 8px;
        text-align: center;
      }

      #scoreTable th {
        background-color: #444;
      }

      .trophy {
        font-size: 20px;
        width: 30px;
        text-align: center;
      }

      .gold {
        color: gold;
      }

      .silver {
        color: silver;
      }

      .bronze {
        color: #cd7f32;
      }

      /* Estilos para a loja */
      #shop {
        margin-top: 20px;
        text-align: center;
      }

      #shop h2 {
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
      }

      .skin {
        display: inline-block;
        margin: 10px;
        cursor: pointer;
        border: 2px solid transparent;
        width: 60px;
        height: 60px;
        position: relative;
      }

      .skin.locked {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .skin.selected {
        border: 2px solid #fff;
      }

      .skin .pattern {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }

      .skin .name {
        position: absolute;
        bottom: -20px;
        width: 100%;
        text-align: center;
        font-size: 14px;
      }

      .skin .price {
        position: absolute;
        bottom: -40px;
        width: 100%;
        text-align: center;
        font-size: 12px;
      }

      #currencyDisplay {
        margin-top: 10px;
        font-size: 20px;
      }

      #errorMessage {
        color: red;
        margin-top: 10px;
      }

      /* Padr√µes das skins */
      .solid {
        background-color: #8bc34a;
      }

      .striped {
        background: repeating-linear-gradient(
          45deg,
          #8bc34a,
          #8bc34a 10px,
          #4caf50 10px,
          #4caf50 20px
        );
      }

      .spotted {
        background-color: #8bc34a;
        background-image: radial-gradient(#4caf50 20%, transparent 20%);
        background-size: 10px 10px;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="message">Pressione Espa√ßo para iniciar o jogo</div>
      <div id="scoreDisplay">Pontua√ß√£o: <span id="currentScore">0</span></div>
      <div id="timeDisplay">
        Tempo: <span id="currentTime">00:00:00:00</span>
      </div>
    </div>
    <div id="scoreboard">
      <h2>Ranking</h2>
      <table id="scoreTable">
        <thead>
          <tr>
            <th>Posi√ß√£o</th>
            <th>Nome</th>
            <th>Tempo</th>
            <th>Frutas</th>
            <th>Pontua√ß√£o</th>
          </tr>
        </thead>
        <tbody id="scoreTableBody"></tbody>
      </table>

      <!-- Loja de Skins -->
      <div id="shop">
        <h2>Loja de Skins</h2>
        <div id="currencyDisplay">
          Dinheiro: $<span id="currencyAmount">0</span>
        </div>
        <div id="skinsContainer"></div>
        <p id="errorMessage"></p>
      </div>
    </div>
    <script>
      window.onload = function () {
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        var gridSize = 20;
        var tileCountX = canvas.width / gridSize;
        var tileCountY = canvas.height / gridSize;

        var snake = [];
        var snakeLength = 5;
        var snakeDirection = "";
        var gameInterval;
        var gameRunning = false;

        var food = { x: 0, y: 0 };
        var currentFruit;
        var fruits = [
          { name: "Ma√ß√£", emoji: "üçé", color: "#ff4d4d", points: 1 },
          { name: "Banana", emoji: "üçå", color: "#ffff66", points: 1 },
          { name: "Uva", emoji: "üçá", color: "#8a2be2", points: 1 },
          { name: "Laranja", emoji: "üçä", color: "#ffa500", points: 1 },
          { name: "Melancia", emoji: "üçâ", color: "#fc6c85", points: 1 },
          { name: "Morango", emoji: "üçì", color: "#ff0000", points: 2 },
          { name: "Cereja", emoji: "üçí", color: "#de3163", points: 2 },
          { name: "Abacaxi", emoji: "üçç", color: "#fce903", points: 1 },
          { name: "P√™ssego", emoji: "üçë", color: "#ffb347", points: 1 },
          { name: "Kiwi", emoji: "ü•ù", color: "#76b852", points: 1 },
          { name: "Pera", emoji: "üçê", color: "#b4eeb4", points: 1 },
          { name: "Lim√£o", emoji: "üçã", color: "#fff44f", points: 1 },
          { name: "Cora√ß√£o", emoji: "‚ù§Ô∏è", color: "#ff0000", points: 3 },
          { name: "Estrela", emoji: "‚≠ê", color: "#ffd700", points: 5 },
          {
            name: "Diamante",
            emoji: "üíé",
            color: "#b9f2ff",
            money: 3,
            points: 0,
          },
          {
            name: "Dinheiro",
            emoji: "üí∞",
            color: "#85bb65",
            points: 0,
            money: 2,
          },
        ];

        var bombs = [];
        var bombInterval;

        var score = 0;
        var fruitsEaten = 0;
        var startTime;
        var elapsedTime = 0;
        var timeInterval;

        var currency = parseInt(localStorage.getItem("snakeCurrency")) || 0;
        updateCurrencyDisplay();

        var skins = [
          { id: 1, name: "Padr√£o", price: 0, unlocked: true, pattern: "solid" },
          {
            id: 2,
            name: "Listrada",
            price: 10,
            unlocked: false,
            pattern: "striped",
          },
          {
            id: 3,
            name: "Pintada",
            price: 15,
            unlocked: false,
            pattern: "spotted",
          },
        ];

        // Carrega skins desbloqueadas do localStorage
        var unlockedSkins = JSON.parse(
          localStorage.getItem("unlockedSkins")
        ) || [1];
        skins.forEach(function (skin) {
          if (unlockedSkins.includes(skin.id)) {
            skin.unlocked = true;
          }
        });

        var selectedSkin = localStorage.getItem("selectedSkin") || 1;
        updateSkinsDisplay();

        document.addEventListener("keydown", keyDownHandler);

        loadScores();
        displayScores();

        function keyDownHandler(e) {
          var key = e.key.toLowerCase();
          if (!gameRunning && key === " ") {
            startGame();
          } else if (gameRunning) {
            if (["w", "a", "s", "d"].includes(key)) {
              changeDirection(key);
            }
          }
        }

        function startGame() {
          snake = [];
          snakeLength = 1;
          snakeDirection = getRandomDirection();
          gameRunning = true;
          score = 0;
          fruitsEaten = 0;
          elapsedTime = 0;
          bombs = [];
          updateScoreDisplay();
          updateTimeDisplay();
          placeFood();
          document.getElementById("message").style.display = "none";
          var startX = Math.floor(tileCountX / 2);
          var startY = Math.floor(tileCountY / 2);
          for (var i = 0; i < snakeLength; i++) {
            snake.push({ x: startX, y: startY, color: "#8bc34a" });
          }
          clearInterval(gameInterval);
          clearInterval(timeInterval);
          clearInterval(bombInterval);
          gameInterval = setInterval(gameLoop, 100);
          startTime = Date.now();
          timeInterval = setInterval(updateElapsedTime, 10); // Atualiza a cada 10ms
          bombInterval = setInterval(placeBomb, 30000); // A cada 30 segundos
        }

        function getRandomDirection() {
          var directions = ["w", "a", "s", "d"];
          return directions[Math.floor(Math.random() * directions.length)];
        }

        function changeDirection(key) {
          if (key === "w" && snakeDirection !== "s") snakeDirection = "w";
          if (key === "s" && snakeDirection !== "w") snakeDirection = "s";
          if (key === "a" && snakeDirection !== "d") snakeDirection = "a";
          if (key === "d" && snakeDirection !== "a") snakeDirection = "d";
        }

        function placeFood() {
          food.x = Math.floor(Math.random() * tileCountX);
          food.y = Math.floor(Math.random() * tileCountY);
          // Verifica se a comida n√£o aparece sobre a cobra ou uma bomba
          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === food.x && snake[i].y === food.y) {
              placeFood();
              return;
            }
          }
          for (var i = 0; i < bombs.length; i++) {
            if (bombs[i].x === food.x && bombs[i].y === food.y) {
              placeFood();
              return;
            }
          }
          currentFruit = fruits[Math.floor(Math.random() * fruits.length)];
        }

        function placeBomb() {
          var bomb = {
            x: Math.floor(Math.random() * tileCountX),
            y: Math.floor(Math.random() * tileCountY),
          };
          // Verifica se a bomba n√£o aparece sobre a cobra ou a comida
          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === bomb.x && snake[i].y === bomb.y) {
              placeBomb();
              return;
            }
          }
          if (food.x === bomb.x && food.y === bomb.y) {
            placeBomb();
            return;
          }
          bombs.push(bomb);
        }

        function gameLoop() {
          var headX = snake[0].x;
          var headY = snake[0].y;

          if (snakeDirection === "w") headY--;
          if (snakeDirection === "s") headY++;
          if (snakeDirection === "a") headX--;
          if (snakeDirection === "d") headX++;

          if (
            headX < 0 ||
            headX >= tileCountX ||
            headY < 0 ||
            headY >= tileCountY
          ) {
            gameOver();
            return;
          }

          // Verifica colis√£o com a pr√≥pria cobra
          for (var i = 0; i < snake.length; i++) {
            if (snake[i].x === headX && snake[i].y === headY) {
              gameOver();
              return;
            }
          }

          // Verifica colis√£o com as bombas
          for (var i = 0; i < bombs.length; i++) {
            if (bombs[i].x === headX && bombs[i].y === headY) {
              score -= 5;
              updateScoreDisplay();
              bombs.splice(i, 1); // Remove a bomba ap√≥s a colis√£o
              break;
            }
          }

          var ateFood = false;
          var eatenFruitColor = snake[0].color; // Cor padr√£o
          if (headX === food.x && headY === food.y) {
            ateFood = true;
            snakeLength++;
            score += currentFruit.points;
            fruitsEaten++;
            updateScoreDisplay();
            eatenFruitColor = currentFruit.color; // Cor da fruta comida

            // Se for o √≠cone de dinheiro, acumula dinheiro
            if (currentFruit.name === "Dinheiro") {
              currency += currentFruit.money;
              updateCurrencyDisplay();
              saveCurrency();
            }

            placeFood();
          }

          var newHeadColor = ateFood ? eatenFruitColor : snake[0].color;
          snake.unshift({ x: headX, y: headY, color: newHeadColor });

          while (snake.length > snakeLength) {
            snake.pop();
          }

          drawGame();
        }

        function drawGame() {
          ctx.fillStyle = "#333";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Desenha a cobra
          for (var i = 0; i < snake.length; i++) {
            ctx.fillStyle = snake[i].color;
            var x = snake[i].x * gridSize;
            var y = snake[i].y * gridSize;

            // Aplica a skin selecionada
            if (selectedSkin == 2) {
              // Skin listrada
              ctx.fillStyle = snake[i].color;
              ctx.fillRect(x, y, gridSize - 1, gridSize - 1);
              ctx.fillStyle = "#000";
              ctx.fillRect(x, y + gridSize / 2, gridSize - 1, gridSize / 2 - 1);
            } else if (selectedSkin == 3) {
              // Skin pintada
              ctx.fillStyle = snake[i].color;
              ctx.fillRect(x, y, gridSize - 1, gridSize - 1);
              ctx.fillStyle = "#000";
              ctx.beginPath();
              ctx.arc(
                x + gridSize / 2,
                y + gridSize / 2,
                gridSize / 4,
                0,
                2 * Math.PI
              );
              ctx.fill();
            } else {
              // Skin padr√£o
              ctx.fillRect(x, y, gridSize - 1, gridSize - 1);
            }
          }

          // Desenha a comida
          ctx.font = gridSize + "px Segoe UI Emoji";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            currentFruit.emoji,
            food.x * gridSize + gridSize / 2,
            food.y * gridSize + gridSize / 2
          );

          // Desenha as bombas
          for (var i = 0; i < bombs.length; i++) {
            ctx.fillText(
              "üí£",
              bombs[i].x * gridSize + gridSize / 2,
              bombs[i].y * gridSize + gridSize / 2
            );
          }
        }

        function gameOver() {
          gameRunning = false;
          clearInterval(gameInterval);
          clearInterval(timeInterval);
          clearInterval(bombInterval);
          var playerName = prompt(
            "Game Over! Sua pontua√ß√£o: " +
              score +
              ". Digite seu nome para salvar no ranking:"
          );
          if (playerName) {
            saveScore(playerName, score, elapsedTime, fruitsEaten);
            displayScores();
          }
          document.getElementById("message").innerText =
            "Pressione Espa√ßo para reiniciar";
          document.getElementById("message").style.display = "block";
        }

        function saveScore(name, score, time, fruitsEaten) {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          scores.push({
            name: name,
            score: score,
            time: time,
            fruits: fruitsEaten,
          });
          scores.sort(function (a, b) {
            return b.score - a.score;
          });
          if (scores.length > 10) {
            scores = scores.slice(0, 10);
          }
          localStorage.setItem("snakeScores", JSON.stringify(scores));
        }

        function loadScores() {
          var scores = JSON.parse(localStorage.getItem("snakeScores")) || [];
          return scores;
        }

        function displayScores() {
          var scores = loadScores();
          var scoreTableBody = document.getElementById("scoreTableBody");
          scoreTableBody.innerHTML = "";
          for (var i = 0; i < scores.length; i++) {
            var tr = document.createElement("tr");

            var positionTd = document.createElement("td");
            var nameTd = document.createElement("td");
            var timeTd = document.createElement("td");
            var fruitsTd = document.createElement("td");
            var scoreTd = document.createElement("td");

            // Posi√ß√£o e Trof√©u
            if (i === 0) {
              positionTd.innerHTML = '<span class="trophy gold">üèÜ</span>';
            } else if (i === 1) {
              positionTd.innerHTML = '<span class="trophy silver">ü•à</span>';
            } else if (i === 2) {
              positionTd.innerHTML = '<span class="trophy bronze">ü•â</span>';
            } else {
              positionTd.textContent = i + 1 + ".";
            }

            // Nome
            nameTd.textContent = scores[i].name;

            // Tempo com cent√©simos
            timeTd.textContent = formatTime(scores[i].time);

            // Frutas
            fruitsTd.textContent = scores[i].fruits;

            // Pontua√ß√£o
            scoreTd.textContent = scores[i].score;

            tr.appendChild(positionTd);
            tr.appendChild(nameTd);
            tr.appendChild(timeTd);
            tr.appendChild(fruitsTd);
            tr.appendChild(scoreTd);

            scoreTableBody.appendChild(tr);
          }
        }

        function updateScoreDisplay() {
          document.getElementById("currentScore").innerText = score;
        }

        function updateElapsedTime() {
          elapsedTime = Date.now() - startTime;
          updateTimeDisplay();
        }

        function updateTimeDisplay() {
          document.getElementById("currentTime").innerText =
            formatTime(elapsedTime);
        }

        function formatTime(milliseconds) {
          var hrs = Math.floor(milliseconds / 3600000);
          var mins = Math.floor((milliseconds % 3600000) / 60000);
          var secs = Math.floor((milliseconds % 60000) / 1000);
          var centis = Math.floor((milliseconds % 1000) / 10);

          return (
            (hrs < 10 ? "0" + hrs : hrs) +
            ":" +
            (mins < 10 ? "0" + mins : mins) +
            ":" +
            (secs < 10 ? "0" + secs : secs) +
            ":" +
            (centis < 10 ? "0" + centis : centis)
          );
        }

        // Fun√ß√µes para a loja
        function updateCurrencyDisplay() {
          document.getElementById("currencyAmount").innerText = currency;
        }

        function saveCurrency() {
          localStorage.setItem("snakeCurrency", currency);
        }

        function updateSkinsDisplay() {
          var skinsContainer = document.getElementById("skinsContainer");
          skinsContainer.innerHTML = "";
          skins.forEach(function (skin) {
            var skinDiv = document.createElement("div");
            skinDiv.classList.add("skin");
            if (!skin.unlocked) {
              skinDiv.classList.add("locked");
            }
            if (skin.id == selectedSkin) {
              skinDiv.classList.add("selected");
            }
            skinDiv.dataset.id = skin.id;

            var patternDiv = document.createElement("div");
            patternDiv.classList.add("pattern", skin.pattern);
            skinDiv.appendChild(patternDiv);

            var nameDiv = document.createElement("div");
            nameDiv.classList.add("name");
            nameDiv.textContent = skin.name;
            skinDiv.appendChild(nameDiv);

            var priceDiv = document.createElement("div");
            priceDiv.classList.add("price");
            if (skin.unlocked) {
              priceDiv.textContent = "Comprado";
            } else {
              priceDiv.textContent = "Pre√ßo: $" + skin.price;
            }
            skinDiv.appendChild(priceDiv);

            skinDiv.addEventListener("click", function () {
              document.getElementById("errorMessage").textContent = "";
              if (skin.unlocked) {
                selectedSkin = skin.id;
                localStorage.setItem("selectedSkin", selectedSkin);
                updateSkinsDisplay();
              } else if (currency >= skin.price) {
                if (
                  confirm(
                    "Deseja comprar a skin " +
                      skin.name +
                      " por $" +
                      skin.price +
                      "?"
                  )
                ) {
                  currency -= skin.price;
                  skin.unlocked = true;
                  unlockedSkins.push(skin.id);
                  localStorage.setItem(
                    "unlockedSkins",
                    JSON.stringify(unlockedSkins)
                  );
                  updateCurrencyDisplay();
                  saveCurrency();
                  updateSkinsDisplay();
                }
              } else {
                document.getElementById("errorMessage").textContent =
                  "Not enough cash";
              }
            });

            skinsContainer.appendChild(skinDiv);
          });
        }
      };
    </script>
  </body>
</html>
